<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ðŸ“Š Stock Market Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="bg-dark text-white">

<div class="container py-4">
  <h1 class="text-center mb-4">ðŸ“ˆ Stock Market Signal Dashboard</h1>

  <!-- Tabs -->
  <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
    <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#watchlist">ðŸ“‹ My Watchlist</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#trending">ðŸ”¥ Trending</button></li>
    <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#alerts">ðŸ”” Alerts</button></li>
  </ul>

  <div class="tab-content">

    <!-- My Watchlist -->
    <div class="tab-pane fade show active" id="watchlist">
      <form method="POST" class="d-flex mb-4">
        <input type="text" name="symbol" placeholder="Enter Symbol (e.g. RELIANCE.NS)" class="form-control me-2">
        <button class="btn btn-success">âž• Add</button>
      </form>
      <div class="row" id="watchlist-cards"></div>
    </div>

    <!-- Trending Stocks -->
    <div class="tab-pane fade" id="trending">
      <div class="row" id="trending-cards"></div>
    </div>

    <!-- Alerts -->
    <div class="tab-pane fade" id="alerts">
      <ul class="list-group text-dark">
        {% for a in alerts %}
          <li class="list-group-item">
            <b>{{ a.symbol }}</b> | â‚¹{{ a.price }} | {{ a.signal }} | {{ a.time }}
          </li>
        {% endfor %}
      </ul>
    </div>

  </div>
</div>

<script>
  const stockData = {{ stock_data|safe }};
  const trendingData = {{ trending_data|safe }};

  function renderCards(data, containerId) {
    const container = document.getElementById(containerId);
    container.innerHTML = "";
    Object.entries(data).forEach(([symbol, d]) => {
      let card = document.createElement("div");
      card.className = "col-md-6 mb-4";
      card.innerHTML = `
        <div class="card bg-secondary text-white shadow">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-start">
              <h4>${symbol}</h4>
              <div class="badge bg-dark text-light">â‚¹${d.price}</div>
            </div>
            <canvas id="chart_${symbol}" height="120"></canvas>
          </div>
        </div>
      `;
      container.appendChild(card);

      new Chart(document.getElementById(`chart_${symbol}`), {
        type: "line",
        data: {
          labels: d.time,
          datasets: [{
            label: `${symbol} Trend`,
            data: d.history,
            borderColor: "#00ffcc",
            backgroundColor: "rgba(0,255,204,0.12)",
            fill: true,
            tension: 0.3
          }]
        },
        options: { responsive: true, maintainAspectRatio: false, scales: { x: { ticks: { maxRotation: 0, autoSkip: true } } } }
      });
    });
  }

  renderCards(stockData, "watchlist-cards");
  renderCards(trendingData, "trending-cards");
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
